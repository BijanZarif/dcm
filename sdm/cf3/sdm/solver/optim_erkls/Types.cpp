// Copyright (C) 2010-2013 von Karman Institute for Fluid Dynamics, Belgium
//
// This software is distributed under the terms of the
// GNU Lesser General Public License version 3 (LGPLv3).
// See doc/lgpl.txt and doc/gpl.txt for the license text.

#include <boost/assign/std/vector.hpp>

#include "cf3/common/Builder.hpp"
#include "cf3/sdm/solver/optim_erkls/Types.hpp"

using namespace boost::assign;
using namespace cf3::common;
using namespace cf3::common::XML;
using namespace cf3::solver;
using namespace cf3::mesh;

namespace cf3 {
namespace sdm {
namespace solver {
namespace optim_erkls {

////////////////////////////////////////////////////////////////////////////////

// Macro to define the declared coefficients in the header file
// Also a builder of the ERK_stage_order solver is created
#define DEFINE_ERK(stage,order) \
  common::ComponentBuilder < ERK_##stage##_##order,  common::Action, LibOptimERKLS > ERK_##stage##_##order##_builder; \
  erk_coeffs::ERK_##stage##_##order::ERK_##stage##_##order() : dcm::solver::erkls::ThreeSstarCoeffs::Coefficients()

////////////////////////////////////////////////////////////////////////////////

// Second order schemes, optimized for second order Spectral Difference
DEFINE_ERK(3,2)
{
  order     = 2;
  nb_stages = 3;
  cfl       = 0.587624777108;

  c         += 0.0, 0.72366074728360086, 0.59236433182015646;
  beta      += 0.72366074728360086, 0.34217876502651023, 0.36640216242653251;
  gamma1    += 0.0, -0.12664395576322218, 1.1426980685848858;
  gamma2    += 1.0, 0.65427782599406470, -0.082869287683723744;
  gamma3    += 0.0, 0.0, 0.0, 0.0;
  delta     += 1.0, 0.72196567116037724, 0.0;
}

DEFINE_ERK(6,2)
{
  order     = 2;
  nb_stages = 6;
  cfl       = 1.251104269176;

  c         += 0.0, 0.40251670280017054, 0.92348560320473438, 1.3365645875459204, 0.56687072891433088, 0.47779705229947389;
  beta      += 0.40251670280017054, 0.77900854518856866, 0.42080622986244898, 0.10570415904421224, 0.033903682253106776, 0.29010467942433543;
  gamma1    += 0.0, 0.37709609023989898, 0.98712330297391482, 0.23950507171681901, 0.18263059352049271, -0.13232724761334236;
  gamma2    += 1.0, 0.64106568246463214, 0.0085033810493140606, 0.18825901672771606, 0.25653339621199744, 0.58270114583116794;
  gamma3    += 0.0, 0.0, 0.0, 0.43885723849931013, 0.11772398100201945, -0.45687788950011093;
  delta     += 1.0, -0.028330595758466828, 0.54263378309169175, 0.19418172549867352, 1.0188224701776252, 0.0;
}

DEFINE_ERK(8,2)
{
  order     = 2;
  nb_stages = 8;
  cfl       = 1.677445545792;

  c         += 0.0, 0.99292229393265474, 1.0732413280565014, 0.25057060509809409, 1.0496674928979783, -0.67488037049720317, -1.5868411612120166, 2.1138242369563969;
  beta      += 0.99292229393265474, 0.52108385130005974, 0.0038505327083543915, 0.79714199213087467, -0.08182246027664912, 0.84604310411858186, -0.10191166090841246, 0.063190236038107500;
  gamma1    += 0.0, 0.42397552118208004, -0.23528852074619033, 0.79598685017877846, -1.3205224623823271, 2.1452956294251941, -0.95532770501880648, 0.25361391125131094;
  gamma2    += 1.0, 0.44390665802303775, 0.75333732286056154, 0.065885460813015481, 0.63976199384289623, -0.73823030755143193, 0.70177211879534529, 0.40185379950224559;
  gamma3    += 0.0, 0.0, 0.0, 0.058415358412023582, 0.64219008773865116, 0.68770305706885126, 0.063729822311671305, -0.33679429978131387;
  delta     += 1.0, 0.29762522910396538, 0.34212961014330662, 0.57010739154759105, 0.41350769551529132, -0.14040672669058066, 0.21249567092409008, 0.0;
}

////////////////////////////////////////////////////////////////////////////////

// Third order schemes, optimized for Third order Spectral Difference
DEFINE_ERK(5,3)
{
  order     = 3;
  nb_stages = 5;
  cfl       = 0.453596841544;
  
  c         += 0.0, 0.2300285982485206, 0.4050045376483964, 0.89478204142351, 0.7235114627562573;
  beta      += 0.2300285982485206, 0.3021449816516716, 0.8025601023885668, 0.4362161887151175, 0.11292705979513513;
  gamma1    += 0.0, 0.25876919610939, -0.1324370838497786, 0.05055664894836298, 0.5670550788302471;
  gamma2    += 1.0, 0.552840139096112, 0.6731851332603277, 0.28031054965521607, 0.5521511581591876;
  gamma3    += 0.0, 0.0, 0.0, 0.27525797946334213, -0.8950544502214851;
  delta     += 1.0, 0.3407687891521679, 0.3414387164789073, 0.7229298408496325, 0.0;
}

DEFINE_ERK(8,3)
{
  order     = 3;
  nb_stages = 8;
  cfl       = 0.808357894420;

  c         += 0.0, 0.30982698508158973, 0.87326704648461639, 0.73001766769154852, 0.55153383598451899, 0.93901839464501213, 0.89315234512281916, -0.052007208869167119;
  beta      += 0.30982698508158973, 0.77200043167443078, 0.43904515751093509, 0.029169201124427328, 0.67740899826454359, 0.48682650046278569, 0.0095918431014952264, 0.13323570180037125;
  gamma1    += 0.0, 0.64979193114553635, -0.23837504551152278, -0.30849164598454815, -0.14231968027824493, 0.73157366471307239, 0.44941981473868520, -0.24592178084456040;
  gamma2    += 1.0, 0.67315108209984342, 0.96573033125271979, 0.90760401592505202, 0.44119365699875335, -0.22309625917204584, -0.22850958912054348, 0.42147220416824505;
  gamma3    += 0.0, 0.0, 0.0, -0.23680885565930257, 0.43337484116982811, 0.74262819835059779, 1.2328445541251383, -0.012473844814723701;
  delta     += 1.0, -0.47974819001699237, 0.76206790747386821, 0.42029560214243528, -0.095736281647911120, 0.51866921114756148, 0.86016614253610924, 0.0;
}

DEFINE_ERK(17,3)
{
  order     = 3;
  nb_stages = 17;
  cfl       = 1.82207767386;
  
  c         += 0.0, 0.04956540301022174, 0.13068799001687578, -0.15883063460310493, 0.35681144740196935, 0.0767271233176427, 0.10812579255374613, 0.187672280848158, 0.9616297693618263, -0.22760719867560897, 1.1115681606027146, 0.6126684542767652, 1.0729473245077408, 0.3782418646810455, 0.7904189134764672, -1.0406955693161675, -0.24607146824557105;
  beta      += 0.04956540301022174, 0.0974087186981594, -0.1762073797680187, 0.1485206917546025, -0.03312765710371495, 0.04829460933049849, 0.04962261219998011, 0.8734076626985038, -0.2869280439908537, 1.2679897532256112, -0.01021743611895345, 0.08466557003259835, 0.028253854742588246, -0.0929367330108044, -0.08479812476680351, -0.016923145636158564, -0.04730510623387996;
  gamma1    += 0.0, 0.7937702396182917, -0.08347511624424175, -0.016706337980062214, 0.36410691500331427, 0.6917825518154278, 1.4887115004739182, 0.4533612556087119, -0.1270577604645874, 0.837498454577477, 0.15709218393361746, -0.5776820708628835, -0.5734039412237539, -1.205073484651447, -2.8100719513641, 0.16142798657609492, -2.5801264756641613;
  gamma2    += 1.0, 0.3285786194081125, 1.127684336118082, 1.3149447395238016, 0.5206289153420905, 0.8812746232516498, 0.4202060644585671, 0.07653263573924612, 0.4438673492468572, 0.06650309395519968, 1.585020916318404, 1.1521721573462576, 1.1172750819374575, 0.7763022391758401, 1.0046657060652295, -0.19795868964959054, 1.3350583594705518;
  gamma3    += 0.0, 0.0, 0.0, 0.8403457457839948, 0.8504773843970515, 0.14082448501410852, -0.3267880246951937, 0.5371635762063554, 0.9022892211519905, 0.15960226946983552, 1.1038153140686748, 0.10843516423068365, 0.46212710442787724, -0.334483121251084, 1.1153826567096696, 1.550324873461354, -1.2200245424704212;
  delta     += 1.0, -0.37235794357769936, 0.33315440189685536, -0.8266763033840252, -0.5462837768103553, 0.6021077763464289, -0.5752871789403107, 0.5091486152920278, 0.38258114767897194, -0.4627906322118529, -0.20820434288562648, 1.4398056081552713, -0.2805660092734875, 2.2767189929551406, -0.5891753010054636, 0.9132865104841816, 0.0;
}

////////////////////////////////////////////////////////////////////////////////

// Fourth order schemes, optimized for Fourth order Spectral Difference
DEFINE_ERK(9,4)
{
  order     = 4;
  nb_stages = 9;
  cfl       = 0.512795113027;
  
  c         += 0.0, 0.2836343248101177, 0.5484074244666177, 0.36872298094969475, -0.6806118302610316, 0.3518526585510562, 1.665941938556217, 0.9715277880746325, 0.9051569434006695;
  beta      += 0.2836343248101177, 0.9736498074748646, 0.338235923641965, -0.3584951893575076, -0.004113958756985946, 1.4279689871485013, 0.018084680519536503, 0.160577088560605, 0.2952226786325481;
  gamma1    += 0.0, -4.65564138375613, -0.7720264968903445, -4.024420272063217, -0.021296873883702272, -2.4350219407769953, 0.019856336960249132, -0.2810789411691381, 0.168943543736779;
  gamma2    += 1.0, 2.4992627683300688, 0.5866820276417473, 1.2051419816240785, 0.3474793749856454, 1.3213458736302766, 0.31196363453264964, 0.4351418924541445, 0.23596980658341213;
  gamma3    += 0.0, 0.0, 0.0, 0.7620985789144936, -0.1981181783296552, -0.6228958709162948, -0.37522475499063573, -0.33554373281046146, -0.045609629702116454;
  delta     += 1.0, 1.2629238731608268, 0.7574967523239173, 0.5163590719619542, -0.027463346616574083, -0.4382674357231867, 1.2735870231839268, -0.6294738221773023, 0.0;
}

DEFINE_ERK(14,4)
{
  order     = 4;
  nb_stages = 14;
  cfl       = 0.882074842229;

  c         += 0.0, 0.058215996422006075, 0.31607197284334321, 0.54914220791433410, 0.24023823797755897, 0.39948760644326259, 1.5932748865090545, 0.17815109776030635, 0.77828739303673755, 0.051311538801347839, 0.15635591253422687, 0.55676958863676274, 0.78589488838677357, 0.83074026917822696;
  beta      += 0.058215996422006075, 0.25719718881331388, 0.25214461436551250, 0.011862427385963454, 0.14587403335438576, 1.1631827180568404, 0.00012223050114367230, 0.48834189398228667, -0.1546483918088544, 0.42060746245245562, 0.099531078459515476, -0.11296894460050493, 0.13397050639364949, 0.57385151995234740;
  gamma1    += 0.0, 1.0071851129597704, 0.95964131301891364, -0.77292964255305607, 0.41150854674848447, 1.5791734211186172, -0.27247353730385981, -0.00097933918053338953, -0.73834536185110466, 1.4265603441376824, 0.42818563796860676, -1.8323265666954589, 0.19970821288974250, -1.6403156922712991;
  gamma2    += 1.0, -0.011316264403475889, 0.085944532931603368, 1.1991169793146206, 0.28458440423194137, -0.46476688383525733, 0.41699421669530284, 0.19473341390764956, 0.70184275061155776, -0.30894455038360547, 0.33707457764930826, 1.6227185491428169, 0.26488732355566597, 0.87776836952092385;
  gamma3    += 0.0, 0.0, 0.0, -0.13949720800933263, 0.13536832395964216, 0.030758455996769195, 0.45408170798232028, 0.59494977104730817, 0.61548597515536208, -0.052423251959834244, 0.022183733872274715, 0.11422913752573897, 0.068314274239510073, 0.21473073269691423;
  delta     += 1.0, -0.36506317777768577, -0.16534689480709672, 1.1252726952919307, -0.0026350706921406193, -0.27988818720866132, 0.65025818824206327, 0.12245585399441455, -0.48518023642543479, -0.38885620426114365, 0.41957360500079460, 0.044436456962519327, 1.0883272275398104, 0.0;
}

DEFINE_ERK(18,4)
{
  order     = 4;
  nb_stages = 18;
  cfl       = 1.17418695241;
  
  c         += 0.0, 0.12384169480626298, 1.1574324659554065, 0.5437209914154693, 0.8839466683428074, -0.12212042176605774, 0.4412568513308208, 0.3803909209547375, 0.05459110734752837, 0.4873185553535603, -0.23007964303896034, -0.18907656662915873, 0.8105980566862376, 0.770808759978688, 1.1712158507200179, 1.2755351018003545, 0.8042250794616856, 0.9750868025076185;
  beta      += 0.12384169480626298, 1.017626253428035, -0.06973202638752743, 0.34239356067806476, 0.018177707207807942, -0.0061188746289480445, 0.07824230890258035, -0.3764286475053295, -0.04507838366669026, -0.7573422820143259, -0.2714922276093512, 0.0011833684341657344, 0.02885831997930804, 0.4600526758697466, 0.01801488706877563, -0.015508175395461857, -0.4009573792927499, 0.1494967836703801;
  gamma1    += 0.0, 1.1750819811951678, 0.3090901789265481, 1.4409117788115862, -0.4356304944569407, 0.20341503014683893, 0.4982835697191769, 3.530773715774549, -0.7931879097589463, 0.8912051335534517, 0.5709100919632097, 0.01691218857501542, 1.007791251932972, -0.6853295375209951, 1.0488165551884063, 0.8364776137182994, 1.308790983044571, 0.9041968170017732;
  gamma2    += 1.0, -0.12891068509748144, 0.35609406666728954, -0.4064807522610424, 0.6071478699520743, 1.0253501186236846, 0.24411240760769423, -1.2813606970134104, 0.816257118923739, 0.10171269354643386, 0.1937937866271127, 0.7440864354485178, -0.12591764563430008, 1.1996463179654226, 0.045772068865370406, 0.8362229207703384, -1.4179124272450148, 0.1366145906533165;
  gamma3    += 0.0, 0.0, 0.0, 0.25583378537249163, 0.5267679436698829, -0.256483756217922, 0.3193243800323639, -0.3110681501085286, 0.47631196164025996, -0.09885372793889578, 0.19274726276883622, 0.03238986085597151, 0.07592398003839751, 0.20635456088664017, -0.08974103255603286, 0.02689993250567619, 0.04188206937955231, 0.06201614891238176;
  delta     += 1.0, 0.3581650044197029, 0.5820802446509358, -0.22615285894283538, -0.21715466578266213, -0.46990441450888265, -0.27986911594744995, 0.985139263552722, -0.118993242328149, 0.4282107312437056, -0.821963552999004, 0.058113997057675074, -0.6128302432543692, 0.5680013619063405, -0.33874970570335106, -0.7307123812513777, 0.08393601696037453, 0.0;
}

////////////////////////////////////////////////////////////////////////////////

// Fifth order schemes, optimized for Fifth order Spectral Difference
DEFINE_ERK(10,5)
{
  order     = 5;
  nb_stages = 10;
  cfl       = 0.361642148346;
  
  c         += 0.0, 0.2597883575703945, 0.09904573115808556, 0.21555118823045644, 0.5007950078415504, 0.559225191485478, 0.5449986973404443, 0.7615224662585274, 0.8427062083063384, 0.9152209807177001;
  beta      += 0.2597883575703945, 0.017770088002098183, 0.24816366373161344, 0.7941736827578567, 0.3885391296870134, 0.14550516642704694, 0.1587517379465581, 0.1650605631593765, 0.21180932999328042, 0.15593923403495016;
  gamma1    += 0.0, 0.40436600785287713, -0.8503427464129503, -6.950894167121848, 0.9238765225232068, -2.5631780399589106, 0.25457448699988827, 0.31258317336761454, -0.7007114800317544, 0.4839620971005707;
  gamma2    += 1.0, 0.6871467069729473, 1.0930247604585732, 3.2259753823377983, 1.041153700841611, 1.2928214888638039, 0.7391462769288883, 0.12391292570651462, 0.18427534793568445, 0.05712788942716116;
  gamma3    += 0.0, 0.0, 0.0, -2.393405159339813, -1.9028544220991284, -2.820042210583564, -1.832698464128229, -0.2199094510807231, -0.40824306603783045, -0.1377669791123628;
  delta     += 1.0, -0.13317784091400336, 0.826042278528983, 1.5137004305165804, -1.3058100631721905, 3.036678789335515, -1.4494582670831953, 3.8343138733685103, 4.122293971801869, 0.0;
}

DEFINE_ERK(20,5)
{
  order     = 5;
  nb_stages = 20;
  cfl       = 0.843896716833;
  
  c         += 0.0, 0.17342385375780556, 0.3048498242003216, 0.5527139564572919, 0.04707920454975004, 0.1565254045132413, 0.18602224049074517, 0.2842662003575145, 0.9509472754879227, 0.6804650107009601, 0.5970536656236006, 1.8970821645077285, 0.29742664004529606, 0.6081346370013494, 0.7308000418847777, 0.9165699904495179, 1.430968755461453, 0.4104382496824915, 0.8489825595229896, 0.3354389625834842;
  beta      += 0.17342385375780556, 0.285690047285648, 0.6872704437977959, 0.1281212106097732, 0.0004913718074040312, 0.04703358444695686, 0.4453999812817082, 1.225982488734372, 0.02061646398502442, 0.15941162575324802, 1.29538036782261, 0.0017287352967302603, 0.11660483420536467, 0.07799703662181552, 0.3256325023441801, 1.0611520488333197, 0.0006589162562804099, 0.08353464770005405, 0.09897257945825248, 0.04301011614509704;
  gamma1    += 0.0, -1.168247970322938, -2.511215503708977, -0.5525996015473599, 0.002924303350951174, -4.794897338538649, -5.309553349718302, -2.3624194456630736, 0.20068995756589547, -1.498580866159771, 0.48941228502377687, -0.10387512755259576, -0.1328766427328819, 0.7585867882283751, -4.332158629409694, 0.48199700138402146, -0.007092475661496067, -0.8842225202950605, -0.8912936709954523, 1.5297157134040762;
  gamma2    += 1.0, 0.8895205215458357, 0.8898812910038519, 0.35701564494677057, 0.24232462479216824, 1.2727083024258155, 1.1126977210342681, 0.513607096454091, 0.11181089682044856, 0.2788127238208523, 0.049032886260666715, 0.04187105106589787, 0.04460246379668622, 0.01489727125115475, 0.2624426969943682, -0.004748605698659029, 0.023219312682036197, 0.06285258897245806, 0.05447371935126896, 0.024345446089014514;
  gamma3    += 0.0, 0.0, 0.0, 0.19595487007932735, -6.98716750391006e-05, 0.1059223116981005, 1.0730426871909635, 0.8925782674438912, -0.14078912484894415, -0.2686989055843426, -0.065175753568318, 0.49177812903108553, 0.4601768477649368, -0.006468951294700825, 0.44034728024115377, 0.6108688576752794, 0.5054645445741016, 0.5466850929307289, 0.7141418242099543, -1.055809528289375;
  delta     += 1.0, 1.4375468781258596, 1.5081653637261594, -0.14575347066062688, 0.3149576108283816, 0.3550591936853693, 0.2361638937456696, 0.10267488547302055, 3.599124352451944, 1.5172890003890782, 1.8171662741779953, 2.876226352143683, 0.46350154228218754, 1.557312211072722, 2.0001066778080254, 0.916906948555343, 2.0474618401365854, -0.32336329115436924, 0.32899060754742177, 0.0;
}

////////////////////////////////////////////////////////////////////////////////

// Undefine the macro again as it no longer needed
#undef DEFINE_ERK

} // erkls
} // solver
} // sdm
} // cf3
